<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сообщения - TalentSphere</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="global-header.css">
    <link rel="stylesheet" href="mobile-header.css">
    <link rel="stylesheet" href="messages-new.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="dashboard-page">

    <!-- Mobile Header -->
    <div class="mobile-header">
        <button class="mobile-menu-btn" id="mobileSidebarToggle">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <span class="mobile-logo-text">TalentSphere</span>
        <div class="mobile-avatar"></div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar glass-effect" id="dashboardSidebar">
        <div class="sidebar-header">
            <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                <div class="logo-icon neon-glow-purple"></div>
                <span class="logo-text">TalentSphere</span>
            </a>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="9" rx="1" />
                    <rect x="14" y="3" width="7" height="5" rx="1" />
                    <rect x="14" y="12" width="7" height="9" rx="1" />
                    <rect x="3" y="16" width="7" height="5" rx="1" />
                </svg>
                <span>Дашборд</span>
            </a>
            <a href="marketplace.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
                </svg>
                <span>Проекты</span>
            </a>
            <a href="profile.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                <span>Профиль</span>
            </a>
            <a href="wallet.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
                    <line x1="1" y1="10" x2="23" y2="10" />
                </svg>
                <span>Кошелек</span>
            </a>
            <a href="messages.html" class="nav-item active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <span>Сообщения</span>
                <span class="badge neon-glow-pink">3</span>
            </a>
            <a href="education.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
                    <path d="M6 12v5c3 3 9 3 12 0v-5" />
                </svg>
                <span>Обучение</span>
            </a>
            <a href="settings.html" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M12 1v6m0 6v6m6-11.66l-3 5.2m-6 0l-3-5.2M1.34 18l5.2-3m5.2 0l5.2 3M1.34 6l5.2 3m5.2 0l5.2-3" />
                </svg>
                <span>Настройки</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile glass-card">
                <div class="user-avatar neon-glow-blue"></div>
                <div class="user-info">
                    <div class="user-name">Alex Design</div>
                    <div class="user-status">Pro Member</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content messages-layout">
        <div class="messages-wrapper glass-card-large">
            <!-- Chat List Panel -->
            <section class="chat-list-panel" id="chatListPanel">
                <header class="chat-list-header">
                    <h2>Сообщения</h2>
                    <button class="new-chat-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </header>

                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Поиск по контактам...">
                </div>

                <div class="chat-list-scrollable">
                    <div class="chat-item" data-chat-id="1" data-chat-name="Анна Власова (Client)">
                        <div class="user-avatar active-status">
                            <img src="https://24smi.org/public/media/celebrity/2021/07/05/hehlqw5gt59z-anna-khilkevich.jpg"
                                alt="A">
                        </div>
                        <div class="chat-info">
                            <div class="chat-header-row">
                                <span class="chat-name">Анна Власова (Client)</span>
                                <span class="chat-time">14:35</span>
                            </div>
                            <div class="chat-preview">
                                <span class="last-message">Отлично, я подтверждаю бюджет проекта...</span>
                            </div>
                        </div>
                    </div>

                    <div class="chat-item" data-chat-id="2" data-chat-name="Максим Барисов (PM)">
                        <div class="user-avatar active-status">
                            <img src="https://avatars.dzeninfra.ru/get-zen_doc/1705626/pub_5e5e236b23f6716bacbc5682_5e5e2590ac9a236dd3d964e0/scale_1200"
                                alt="M">
                        </div>
                        <div class="chat-info">
                            <div class="chat-header-row">
                                <span class="chat-name">Максим Барисов (PM)</span>
                                <span class="chat-time">Вчера</span>
                            </div>
                            <div class="chat-preview">
                                <span class="last-message">Нам нужно обсудить новый бриф. **[3]**</span>
                                <span class="unread-count">3</span>
                            </div>
                        </div>
                    </div>

                    <div class="chat-item" data-chat-id="3" data-chat-name="Дмитрий Самолен (Dev)">
                        <div class="user-avatar">
                            <img src="https://avatars.mds.yandex.net/i?id=9200388277260533513-4573663-images-thumbs&n=13"
                                alt="D">
                        </div>
                        <div class="chat-info">
                            <div class="chat-header-row">
                                <span class="chat-name">Дмитрий Самолен (Dev)</span>
                                <span class="chat-time">09:00</span>
                            </div>
                            <div class="chat-preview">
                                <span class="last-message">Файлы готовы. Проверьте в Git.</span>
                            </div>
                        </div>
                    </div>

                    <div class="chat-item" data-chat-id="4" data-chat-name="Служба Поддержки">
                        <div class="user-avatar">
                            <img src="https://img.freepik.com/premium-vector/customer-support-illustration-flat-style-vector-design_550828-18.jpg"
                                alt="S">
                        </div>
                        <div class="chat-info">
                            <div class="chat-header-row">
                                <span class="chat-name">Служба Поддержки</span>
                                <span class="chat-time">13.01</span>
                            </div>
                            <div class="chat-preview">
                                <span class="last-message">Ваш запрос #457 обработан.</span>
                            </div>
                        </div>
                    </div>

                    <div class="chat-item" data-chat-id="5" data-chat-name="Татьяна (HR)">
                        <div class="user-avatar">
                            <img src="https://avatars.mds.yandex.net/i?id=a5a676451672323267323e232323-5232323-images-thumbs&n=13"
                                alt="T">
                        </div>
                        <div class="chat-info">
                            <div class="chat-header-row">
                                <span class="chat-name">Татьяна (HR)</span>
                                <span class="chat-time">25.12</span>
                            </div>
                            <div class="chat-preview">
                                <span class="last-message">С наступающим!</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat Window Panel -->
            <section class="chat-window-panel" id="chatWindowPanel">
                <header class="window-header">
                    <div class="header-user-info">
                        <!-- Back button for mobile -->
                        <div class="mobile-back-btn" id="mobileBackBtn" style="display: none;">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                        <div class="user-avatar active-status">
                            <img src="https://24smi.org/public/media/celebrity/2021/07/05/hehlqw5gt59z-anna-khilkevich.jpg"
                                alt="A" id="activeChatAvatar">
                        </div>
                        <div class="user-details">
                            <h3 id="activeChatName">Анна Власова (Client)</h3>
                            <p class="project-title">Проект: E-commerce Website</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="action-btn" title="Позвонить">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="action-btn" title="Видеозвонок">
                            <i class="fas fa-video"></i>
                        </button>
                    </div>
                </header>

                <div class="messages-container" id="messagesContainer">
                    <!-- Messages will be loaded here -->
                    <div class="message received">
                        <div class="msg-content">
                            Здравствуйте! Мы готовы начать работу. У нас есть несколько вопросов по структуре навигации.
                            <span class="msg-time">14:28</span>
                        </div>
                    </div>
                    <div class="message sent">
                        <div class="msg-content">
                            Добрый день, Анна. Отлично! Прикрепите, пожалуйста, файлы с архитектурой сайта.
                            <span class="msg-time">14:30</span>
                        </div>
                    </div>
                    <div class="message sent">
                        <div class="msg-content">
                            Также, я подтверждаю получение Escrow-платежа за первый этап работ ($1600).
                            <span class="msg-time">14:31</span>
                        </div>
                    </div>
                    <div class="message received">
                        <div class="msg-content">
                            Отлично, я подтверждаю бюджет проекта **"E-commerce Website"**.
                            <span class="msg-time">14:35</span>
                        </div>
                    </div>
                </div>

                <div class="input-panel">
                    <div class="attach-button">
                        <i class="fas fa-paperclip"></i>
                    </div>
                    <input type="text" placeholder="Написать сообщение..." id="messageInput">
                    <button class="send-button" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Call Modal -->
    <div class="call-modal-overlay" id="callModalOverlay">
        <div class="call-modal glass-card-large">
            <div class="call-header">
                <div class="call-status">
                    <span class="status-dot"></span>
                    <span id="callStatusText">Calling...</span>
                </div>
                <div class="call-timer" id="callTimer">00:00</div>
            </div>

            <div class="call-content">
                <div class="video-container" id="videoContainer">
                    <!-- Placeholder for video or large avatar -->
                    <div class="large-avatar">
                        <img src="" alt="User" id="callAvatar">
                    </div>
                    <div class="user-info-large">
                        <h2 id="callName">User Name</h2>
                        <p id="callRole">Role</p>
                    </div>
                </div>
            </div>

            <div class="call-controls">
                <button class="control-btn" id="micBtn" title="Mute">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="control-btn" id="cameraBtn" title="Camera">
                    <i class="fas fa-video"></i>
                </button>
                <button class="control-btn end-call-btn" id="endCallBtn" title="End Call">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatItems = document.querySelectorAll('.chat-item');
            const chatListPanel = document.getElementById('chatListPanel');
            const chatWindowPanel = document.getElementById('chatWindowPanel');
            const mobileBackBtn = document.getElementById('mobileBackBtn');
            const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
            const sidebar = document.getElementById('dashboardSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            // Check if mobile (sync with CSS breakpoint)
            const isMobile = () => window.matchMedia('(max-width: 1024px)').matches;

            // Mobile Sidebar Toggle
            if (mobileSidebarToggle) {
                mobileSidebarToggle.addEventListener('click', () => {
                    sidebar.classList.add('active');
                    sidebarOverlay.classList.add('active');
                });
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', () => {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                });
            }

            // Initial Mobile State
            if (isMobile()) {
                mobileBackBtn.style.display = 'block';
                chatWindowPanel.classList.remove('active');
                chatItems.forEach(i => i.classList.remove('active'));
            }

            // Resize Handler
            window.addEventListener('resize', () => {
                if (isMobile()) {
                    mobileBackBtn.style.display = 'block';
                    // If no chat selected, ensure list is visible
                    if (!chatWindowPanel.classList.contains('active')) {
                        chatListPanel.style.display = 'flex';
                    }
                } else {
                    mobileBackBtn.style.display = 'none';
                    chatListPanel.style.display = 'flex';
                    chatWindowPanel.style.transform = 'none';
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                }
            });

            // Chat Item Click
            chatItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Remove active from all
                    chatItems.forEach(i => i.classList.remove('active'));
                    // Add active to clicked
                    item.classList.add('active');

                    // Update Chat Window Info
                    const name = item.getAttribute('data-chat-name');
                    const img = item.querySelector('img').src;
                    document.getElementById('activeChatName').textContent = name;
                    document.getElementById('activeChatAvatar').src = img;

                    // Mobile Logic
                    if (isMobile()) {
                        chatWindowPanel.classList.add('active');
                    }
                });
            });

            // Back Button Click
            if (mobileBackBtn) {
                mobileBackBtn.addEventListener('click', () => {
                    chatWindowPanel.classList.remove('active');
                    // Deselect items
                    chatItems.forEach(i => i.classList.remove('active'));
                });
            }

            // Call Modal Logic
            const callModalOverlay = document.getElementById('callModalOverlay');
            const callStatusText = document.getElementById('callStatusText');
            const callTimer = document.getElementById('callTimer');
            const callAvatar = document.getElementById('callAvatar');
            const callName = document.getElementById('callName');
            const callRole = document.getElementById('callRole');
            const micBtn = document.getElementById('micBtn');
            const cameraBtn = document.getElementById('cameraBtn');
            const endCallBtn = document.getElementById('endCallBtn');

            let callInterval;
            let seconds = 0;
            let isMuted = false;
            let isCameraOff = false;

            const formatTime = (totalSeconds) => {
                const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                const s = (totalSeconds % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            };

            const startCall = (isVideo) => {
                const activeName = document.getElementById('activeChatName').textContent;
                const activeImg = document.getElementById('activeChatAvatar').src;

                callName.textContent = activeName;
                callAvatar.src = activeImg;
                callRole.textContent = isVideo ? 'Video Call' : 'Voice Call';

                callModalOverlay.classList.add('active');
                callStatusText.textContent = 'Connecting...';
                seconds = 0;
                callTimer.textContent = '00:00';

                // Simulate connection after 1.5s
                setTimeout(() => {
                    callStatusText.textContent = 'Connected';
                    callInterval = setInterval(() => {
                        seconds++;
                        callTimer.textContent = formatTime(seconds);
                    }, 1000);
                }, 1500);

                if (isVideo) {
                    cameraBtn.classList.add('active');
                    isCameraOff = false;
                } else {
                    cameraBtn.classList.remove('active');
                    isCameraOff = true;
                }
            };

            const endCall = () => {
                callModalOverlay.classList.remove('active');
                clearInterval(callInterval);
                seconds = 0;
                callTimer.textContent = '00:00';
            };

            // Bind Call Buttons
            const callBtns = document.querySelectorAll('.action-btn');
            if (callBtns.length >= 2) {
                // Phone Button
                callBtns[0].addEventListener('click', () => startCall(false));
                // Video Button
                callBtns[1].addEventListener('click', () => startCall(true));
            }

            // Control Buttons
            micBtn.addEventListener('click', () => {
                isMuted = !isMuted;
                micBtn.classList.toggle('active');
                micBtn.innerHTML = isMuted ? '<i class="fas fa-microphone-slash"></i>' : '<i class="fas fa-microphone"></i>';
            });

            cameraBtn.addEventListener('click', () => {
                isCameraOff = !isCameraOff;
                cameraBtn.classList.toggle('active');
                cameraBtn.innerHTML = isCameraOff ? '<i class="fas fa-video-slash"></i>' : '<i class="fas fa-video"></i>';
            });

            endCallBtn.addEventListener('click', endCall);

            // Send Message Logic
            const sendBtn = document.getElementById('sendMessageBtn');
            const input = document.getElementById('messageInput');
            const container = document.getElementById('messagesContainer');

            const sendMessage = () => {
                const text = input.value.trim();
                if (text) {
                    const msgDiv = document.createElement('div');
                    const now = new Date();
                    const timeString = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();

                    msgDiv.innerHTML = `
                        <div class="msg-content">
                            ${text}
                            <span class="msg-time">${timeString}</span>
                        </div>
                    `;

                    messagesContainer.appendChild(msgDiv);
                    messageInput.value = '';
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;

                    // Simulated Reply
                    setTimeout(() => {
                        const replyDiv = document.createElement('div');
                        replyDiv.classList.add('message', 'received');
                        replyDiv.innerHTML = `
                            <div class="msg-content">
                                Получено: "${text}"
                                <span class="msg-time">${timeString}</span>
                            </div>
                        `;
                        messagesContainer.appendChild(replyDiv);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 1000);
                }
            }

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        });
    </script>
</body>

</html>